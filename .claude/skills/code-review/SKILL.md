---
name: code-review
description: コードレビューを実施。コード品質、バグ、セキュリティ、パフォーマンス、可読性を分析します。Use when reviewing code, checking code quality, or when the user asks for a code review.
---

# Code Review Skill

コードレビューを体系的に実施し、品質向上のためのフィードバックを提供します。

## レビュー手順

### Step 0: プロジェクトルールの読み込み（必須）
**レビュー開始前に、必ず以下のルールファイルをすべて読み込むこと。**

1. `.claude/rules/` ディレクトリ内のすべてのファイルを `Glob` で検索する
   - パターン: `.claude/rules/**/*.md`
2. 検出されたすべてのルールファイルを `Read` ツールで読み込む
3. 読み込んだルールを「ベストプラクティス準拠」の基準として適用する

> **重要**: ルールファイルの読み込みを省略してはならない。ルールファイルに記載された規約への違反は、レビューで必ず指摘すること。

### Step 1: 対象コードの特定
1. レビュー対象のファイルまたは変更差分を特定する
2. `git diff` または指定されたファイルを読み込む
3. 関連するコンテキスト（依存ファイル、型定義など）を確認する

### Step 2: 多角的分析の実施
以下の6つの観点から分析を行う:

#### 1. コード品質 (Code Quality)
- [ ] 命名規則は適切か（変数名、関数名、クラス名）
- [ ] 関数の責務は単一か（Single Responsibility Principle）
- [ ] コードの重複はないか（DRY原則）
- [ ] 適切なエラーハンドリングがあるか
- [ ] コメントは必要十分か

#### 2. バグの可能性 (Potential Bugs)
- [ ] 境界値の処理は正しいか
- [ ] null/undefined のチェックは適切か
- [ ] 非同期処理のエラーハンドリングは適切か
- [ ] 競合状態（race condition）のリスクはないか
- [ ] メモリリークの可能性はないか

#### 3. セキュリティリスク (Security Risks)
- [ ] ユーザー入力のバリデーションは適切か
- [ ] XSS脆弱性のリスクはないか
- [ ] SQLインジェクションのリスクはないか
- [ ] 機密情報のハードコーディングはないか
- [ ] 認証・認可の処理は適切か

#### 4. パフォーマンス (Performance)
- [ ] 不要な再レンダリングはないか（React）
- [ ] N+1問題のリスクはないか
- [ ] 重い処理のメモ化は適切か
- [ ] 不要なAPI呼び出しはないか
- [ ] 適切なデータ構造を使用しているか

#### 5. 可読性・保守性 (Readability & Maintainability)
- [ ] コードの構造は理解しやすいか
- [ ] 複雑度は適切か（ネストが深すぎないか）
- [ ] 型定義は適切か（TypeScript）
- [ ] テストは書きやすい構造か
- [ ] 変更に強い設計か

#### 6. ベストプラクティス準拠 (Best Practices)
- [ ] **`.claude/rules/` のルールファイルに準拠しているか（最重要）**
- [ ] プロジェクトのコーディング規約に従っているか
- [ ] フレームワーク推奨のパターンを使用しているか
- [ ] ESLint/Prettier等のルールに準拠しているか
- [ ] 適切なディレクトリ構成か
- [ ] 依存関係は最小限か

### Step 3: レビュー結果の出力

レビュー結果は以下のフォーマットで出力する:

```markdown
## Code Review Report

### Summary
[レビューの概要と総合評価]

### Critical Issues (必須修正)
- [ ] [Issue 1]: [説明] (ファイル:行番号)
- [ ] [Issue 2]: [説明] (ファイル:行番号)

### Warnings (推奨修正)
- [ ] [Warning 1]: [説明] (ファイル:行番号)
- [ ] [Warning 2]: [説明] (ファイル:行番号)

### Suggestions (提案)
- [Suggestion 1]: [説明]
- [Suggestion 2]: [説明]

### Good Points (良い点)
- [Good 1]: [説明]
- [Good 2]: [説明]

### Detailed Findings

#### コード品質
[詳細な所見]

#### バグの可能性
[詳細な所見]

#### セキュリティリスク
[詳細な所見]

#### パフォーマンス
[詳細な所見]

#### 可読性・保守性
[詳細な所見]

#### ベストプラクティス準拠
[詳細な所見]

#### プロジェクトルール準拠 (.claude/rules)
[各ルールファイルに対する準拠状況と違反箇所の詳細]
```

## 使用例

### 特定ファイルのレビュー
```
/code-review src/components/UserForm.tsx
```

### Git差分のレビュー
```
/code-review --diff
```

### PRのレビュー
```
/code-review --pr 123
```

## 注意事項

- レビューは建設的なフィードバックを心がける
- 問題点だけでなく、良い点も積極的に指摘する
- 修正案を具体的に提示する
- 重要度に応じて優先順位をつける
